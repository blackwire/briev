'use strict';

const $ = require('jquery.js'),
      filesys = require('fs'),
      electron = require('electron');

exports.init = function(container)
{
    let entities = [],
        filter = new RegExp('', 'i');

    // handle searching through storage using the input box on the page
    // ----------------------------------------------------------------------------------
        container.on('keyup', 'input', function()
        {
            let input = $(this),
                regex = input.val().split(' ').join('_').replace(/[-[\]{}()*+?.,\\/^$|#\s]/g, '\\$&').replace(/(\_)/g, '.*');

            try
            { filter = new RegExp(regex, 'i'); }

            catch (exception)
            { return; }

            container.trigger('loaded');
        });

        filesys.readFile(__dirname + '/entities.json', 'utf-8', function(err, data)
        {
            if (err)
            { return; }

            entities = JSON.parse(data);
            container.trigger('loaded');
        });

        container.on('loaded', function()
        {
            let list = $('list', container),
                itemHTML = '';

            entities.forEach(function(item)
            {
                let text = `${item.raw} ${item.js} ${item.css} ${item.standard} ${item.hex} ${item.decimal} ${item.description}`;
                if (!text.match(filter))
                { return true; }

                itemHTML += `
                    <item>
                        <column>${item.example}</column>
                        <desc>${item.description}</desc>
                        <column>javascript: ${item.js}</column>
                        <column>css: ${item.css}</column>
                        <column>html (named): ${item.standard}</column>
                        <column>html (hexadecimal): ${item.hex}</column>
                        <column>html (decimal): ${item.decimal}</column>
                    </item>
                `;
            });

            list.html(itemHTML);
        });
    // ----------------------------------------------------------------------------------


    // scroll to the top of the page (this is a long list)
    // ----------------------------------------------------------------------------------
        let menu = container.next('menu');
        menu.on('click', '#top', function()
        { container.scrollTop(0); });
    // ----------------------------------------------------------------------------------

    $('input', container).trigger('keyup');
}